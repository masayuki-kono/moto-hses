---
description: "Implementation rules for Moto-HSES Rust Client. USE WHEN: implementing features, running tests, or reviewing code."
globs: "**/*"
alwaysApply: true
---

# Moto-HSES Rust Client Library Development Rules

## Development Approach

This project implements features step by step, ensuring that unit tests pass at each stage of development.

## Basic Rules

### 1. Incremental Implementation Principle

- Run unit tests after each step completion and ensure all tests pass
- If tests fail, do not proceed to the next step until fixes are complete

### 2. Specification Reference Priority

When there are unclear points, refer to specifications in the following order:

1. `docs/design/protocol-commands.md` - HSES Protocol Command Reference
2. `docs/design/architecture.md` - Architecture Design
3. `docs/specs/hses-protocol.md` - HSES Protocol Specification

### 3. Code Quality

- Resolve `cargo clippy` warnings
- Use `cargo fmt` to standardize code formatting

## Testing Strategy

### Unit Test Execution

```bash
# Protocol layer tests
cd moto-hses-proto && cargo test

# Client layer tests
cd moto-hses-client && cargo test

# Mock server tests
cd moto-hses-mock && cargo test
```

### Integration Test Execution

```bash
# Run protocol communication tests in moto-hses-mock
cargo test --test protocol_communication_tests

# Run comprehensive integration tests between moto-hses-client and moto-hses-mock
cargo test --test integration_tests
```

## Debugging and Troubleshooting

### Common Issues

1. **Protocol Errors**: Verify consistency with HSES Protocol Specification
2. **Type Errors**: Check `VariableType` trait implementation
3. **Serialization Errors**: Verify byte order and data structure
4. **Network Errors**: Check UDP communication settings and timeouts

### Test Failure Response

1. Analyze failed test cases in detail
2. Verify consistency between implementation and specification
3. Apply fixes incrementally
4. Re-run all tests after fixes

### Logs

Integration test logs from `cargo test --test integration_tests` are output to:
```
moto-hses-client/logs/integration_tests.log
```

When analyzing communication errors between client and mock server, check the output logs to verify that sent and received data are consistent.
